-- Spelling Race Auto Spell Script for Delta Executor
-- UI Toggle + Auto Types the detected word in ~1 second
-- Detects the main word TextLabel on screen

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SpellRaceAuto"
ScreenGui.Parent = game:GetCoreGuiType() == Enum.CoreGuiType.All and game.CoreGui or PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 220, 0, 120)
MainFrame.Position = UDim2.new(0, 20, 0, 20)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Spell Race Auto"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(1, -20, 0, 40)
ToggleBtn.Position = UDim2.new(0, 10, 0, 50)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
ToggleBtn.Text = "Turn ON Auto Spell"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextScaled = true
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Parent = MainFrame

local BtnCorner = Instance.new("UICorner")
BtnCorner.CornerRadius = UDim.new(0, 8)
BtnCorner.Parent = ToggleBtn

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 25)
StatusLabel.Position = UDim2.new(0, 0, 1, -25)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "OFF | Last: None"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextScaled = true
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Parent = MainFrame

getgenv().AutoSpellEnabled = false
local lastWord = ""

local function getCurrentWord()
    local candidates = {}
    for _, obj in pairs(PlayerGui:GetDescendants()) do
        if obj:IsA("TextLabel") and obj.Visible and obj.Text ~= "" and obj.Text ~= " " then
            local text = obj.Text:gsub("%s+", "")
            if #text > 2 and text:match("^[a-zA-Z]+$") and obj.TextSize > 24 then
                table.insert(candidates, {obj = obj, text = obj.Text})
            end
        end
    end
    -- Sort by TextSize descending, then by AbsoluteSize
    table.sort(candidates, function(a, b)
        if a.obj.TextSize ~= b.obj.TextSize then
            return a.obj.TextSize > b.obj.TextSize
        end
        return a.obj.AbsoluteSize.X * a.obj.AbsoluteSize.Y > b.obj.AbsoluteSize.X * b.obj.AbsoluteSize.Y
    end)
    return candidates[1] and candidates[1].text or nil
end

local function typeChar(char)
    local isUpper = char == char:upper()
    local keyCodeName = char:upper()
    local keyCode = Enum.KeyCode[keyCodeName]
    if not keyCode then return end

    if isUpper then
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
    end
    VirtualInputManager:SendKeyEvent(true, keyCode, false, game)
    VirtualInputManager:SendKeyEvent(false, keyCode, false, game)
    if isUpper then
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
    end
end

local function typeWord(word)
    if #word == 0 then return end
    local totalDelay = 1 -- 1 second total typing time
    local charDelay = totalDelay / #word
    for i = 1, #word do
        local char = word:sub(i, i)
        typeChar(char)
        wait(charDelay)
    end
    -- Press Enter
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
end

ToggleBtn.MouseButton1Click:Connect(function()
    getgenv().AutoSpellEnabled = not getgenv().AutoSpellEnabled
    if getgenv().AutoSpellEnabled then
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
        ToggleBtn.Text = "Turn OFF Auto Spell"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        StatusLabel.Text = "ON | Detecting..."
    else
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
        ToggleBtn.Text = "Turn ON Auto Spell"
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        StatusLabel.Text = "OFF | Last: " .. (lastWord ~= "" and lastWord or "None")
    end
end)

local heartbeatConnection
heartbeatConnection = RunService.Heartbeat:Connect(function()
    if not getgenv().AutoSpellEnabled then return end

    local currentWord = getCurrentWord()
    if currentWord and currentWord ~= lastWord and currentWord ~= "" then
        lastWord = currentWord
        StatusLabel.Text = "ON | Last: " .. currentWord
        spawn(function()
            typeWord(currentWord)
        end)
    end
end)

-- Make frame draggable
local dragging = false
local dragStart = nil
local startPos = nil

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

print("Spell Race Auto Spell loaded! Toggle with the UI.")
